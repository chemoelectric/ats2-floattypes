(*

Copyright Â© 2021 Barry Schwartz

This program is free software: you can redistribute it and/or
modify it under the terms of the GNU General Public License, as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received copies of the GNU General Public License
along with this program. If not, see
<https://www.gnu.org/licenses/>.

*)

#include "share/atspre_define.hats"
#include "share/atspre_staload.hats"

#include "floattypes/HATS/floattypes.hats"

staload "array2d.sats"
staload _ = "array2d.dats"

staload "tred2.sats"
staload _ = "tred2.dats"

typedef flt = float128
macdef f2f = g0float2float

fn
tred2_float128 {nm, n : nat | n <= nm}
               {na    : int | nm * n <= na}
               {nd    : int | n <= nd}
               {ne    : int | n <= ne}
               {nz    : int | nm * n <= nz}
               (nm    : size_t nm,
                n     : size_t n,
                a     : &array(float128, na),
                d     : &array(float128, nd),
                e     : &array(float128, ne),
                z     : &array(float128, nz)) : void =
  tred2<float128_kind>(nm, n, a, d, e, z)

implement
main () =
  let
    var a : array(flt, 100) = @[flt][100](f2f 0.0)
    var d : array(flt, 100) = @[flt][100](f2f 0.0)
    var e : array(flt, 100) = @[flt][100](f2f 0.0)
    var z : array(flt, 100) = @[flt][100](f2f 0.0)

    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 0, i2sz 0, f2f 1.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 0, i2sz 1, f2f 2.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 0, i2sz 2, f2f 3.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 1, i2sz 0, f2f 4.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 1, i2sz 1, f2f 5.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 1, i2sz 2, f2f 6.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 2, i2sz 0, f2f 7.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 2, i2sz 1, f2f 8.0)
    val _ = arr2put {3, 3} (i2sz 3, a, i2sz 2, i2sz 2, f2f 9.0)

    val _ = arr2copy_lower_triangle (i2sz 3, i2sz 3, a, z)

    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 0, i2sz 0) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 0, i2sz 1) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 0, i2sz 2) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 1, i2sz 0) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 1, i2sz 1) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 1, i2sz 2) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 2, i2sz 0) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 2, i2sz 1) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, z, i2sz 2, i2sz 2) : flt)

    val _ = tred2_float128(i2sz 3, i2sz 3, a, d, e, a)

    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 0, i2sz 0) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 0, i2sz 1) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 0, i2sz 2) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 1, i2sz 0) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 1, i2sz 1) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 1, i2sz 2) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 2, i2sz 0) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 2, i2sz 1) : flt)
    val _ = println!(arr2get {3, 3} (i2sz 3, a, i2sz 2, i2sz 2) : flt)

    val _ = println!(d[i2sz 0] : flt)
    val _ = println!(d[i2sz 1] : flt)
    val _ = println!(d[i2sz 2] : flt)
  in
    0
  end
