OBJEXT = o

PKGCONFIG := pkg-config
PKGCONFIG_CMD := $(PKGCONFIG) $(if ${PATSHOME},--define-variable=PATSHOME="${PATSHOME}")

PATSCCOMP := $(shell $(PKGCONFIG_CMD) --variable=PATSCCOMP ats2-floattypes)
PATSCCFLAGS := $(shell $(PKGCONFIG_CMD) --variable=PATSCCFLAGS ats2-floattypes)
CFLAGS := $(shell $(PKGCONFIG_CMD) --cflags ats2-floattypes)
LIBS := $(shell $(PKGCONFIG_CMD) --libs ats2-floattypes)

# The default C compiler settings for patscc are unsuitable. One
# should use the C compiler options with which the library was built.
PATSCC := patscc
PATSCC_CMD := $(PATSCC) -atsccomp "$(PATSCCOMP)"

tred2-example: tred2-example.dats \
				tred2.dats tred2.sats \
				array2d.dats array2d.sats \
				proofs.dats proofs.sats
	$(PATSCC_CMD) -o $(@) $(PATSCCFLAGS) $(^) $(LIBS)

.PHONY: clean
clean:
	-rm -f tred2-example
	-rm -f *.{c,$(OBJEXT)}
