PKGCONFIG = pkg-config

OBJEXT = o

CC := @CC@
CPPFLAGS := \
	$(shell $(PKGCONFIG) --cflags ats2-floattypes) \
	-I${PATSHOME} \
	-I${PATSHOME}/ccomp/runtime
CFLAGS := -L${PATSHOME}/ccomp/atslib/lib \
			$(shell $(PKGCONFIG) --libs ats2-floattypes)

# The default C compiler for patscc is unsuitable. One should use the
# C compiler options with which the library was built.
PATSCC := patscc
PATSCCFLAGS := -atsccomp "$(CC) $(CPPFLAGS) $(CFLAGS)" \
				$(shell $(PKGCONFIG) --variable=PATSCCFLAGS ats2-floattypes)

tql2-example: tql2-example.dats \
				tred2.dats tred2.sats \
				array2d.dats array2d.sats \
				proofs.dats proofs.sats
	$(PATSCC) -o $(@) $(PATSCCFLAGS) $(^) $(LDFLAGS)

.PHONY: clean
clean:
	-rm -f tql2-example
	-rm -f *.{c,$(OBJEXT)}
